---
description: 
globs: 
alwaysApply: false
---
# Project Organization Guide

**Project**: dhafnck_mcp - Advanced MCP Server Framework
**Version**: Dynamic (from git tags)
**Last Updated**: 2025-01-18
**Repository**: https://github.com/phamhung075/dhafnck_mcp

## Overview

This document provides a comprehensive guide to the organization and structure of the **dhafnck_mcp** project, a Python library (â‰¥3.10) designed as an advanced MCP (Model Context Protocol) server framework with integrated task management capabilities. The project implements a clean architecture with comprehensive task management system migrated and enhanced from the cursor_agent system.

## ðŸ—ï¸ Project Architecture

### Core Architecture Pattern
- **dhafnck_mcp Framework**: Advanced MCP server and client implementation
- **Model Context Protocol (MCP)**: Standard protocol for AI model context management
- **Task Management Integration**: DDD-based task management system with MCP server capabilities
- **Plugin Architecture**: Modular tools, resources, prompts, and utilities
- **Type-Safe**: Fully typed codebase with Pyright validation
- **Test-Driven**: Comprehensive testing across all components

## ðŸ“ Directory Structure

```
dhafnck_mcp_main/
â”œâ”€â”€ ðŸ“„ pyproject.toml              # Python project configuration (dhafnck_mcp)
â”œâ”€â”€ ðŸ“„ uv.lock                     # UV dependency lock file
â”œâ”€â”€ ðŸ“„ justfile                    # Task automation (uv-based workflow)
â”œâ”€â”€ ðŸ“„ LICENSE                     # Apache 2.0 License
â”œâ”€â”€ ðŸ“„ AGENTS.md                   # Agent development guidelines
â”œâ”€â”€ ðŸ“„ Windows_Notes.md            # Windows-specific development notes
â”œâ”€â”€ ðŸ“ src/                        # Source code (dhafnck_mcp library)
â”‚   â””â”€â”€ ðŸ“ fastmcp/                # Main dhafnck_mcp package (internal structure)
â”‚       â”œâ”€â”€ ðŸ“„ __init__.py         # Package exports (dhafnck_mcp, Context, Client)
â”‚       â”œâ”€â”€ ðŸ“„ settings.py         # Configuration management
â”‚       â”œâ”€â”€ ðŸ“„ exceptions.py       # dhafnck_mcp-specific exceptions
â”‚       â”œâ”€â”€ ðŸ“„ py.typed            # Type annotations marker
â”‚       â”œâ”€â”€ ðŸ“ server/             # MCP Server implementation
â”‚       â”œâ”€â”€ ðŸ“ client/             # MCP Client SDK + helpers
â”‚       â”œâ”€â”€ ðŸ“ tools/              # MCP Tool implementations
â”‚       â”œâ”€â”€ ðŸ“ resources/          # MCP Resources and templates
â”‚       â”œâ”€â”€ ðŸ“ prompts/            # MCP Prompt templates
â”‚       â”œâ”€â”€ ðŸ“ utilities/          # Shared utilities and types
â”‚       â”œâ”€â”€ ðŸ“ contrib/            # Community contributions
â”‚       â””â”€â”€ ðŸ“ task_management/    # Integrated task management (DDD architecture)
â”‚           â”œâ”€â”€ ðŸ“ domain/         # Domain layer (business logic)
â”‚           â”œâ”€â”€ ðŸ“ application/    # Application layer (use cases)
â”‚           â”œâ”€â”€ ðŸ“ infrastructure/ # Infrastructure layer (external concerns)
â”‚           â””â”€â”€ ðŸ“ interface/      # Interface layer (MCP integration)
â”œâ”€â”€ ðŸ“ tests/                      # Comprehensive test suite
â”‚   â”œâ”€â”€ ðŸ“„ conftest.py             # Pytest configuration
â”‚   â”œâ”€â”€ ðŸ“ auth/                   # Authentication tests
â”‚   â”œâ”€â”€ ðŸ“ cli/                    # CLI tests
â”‚   â”œâ”€â”€ ðŸ“ client/                 # Client SDK tests
â”‚   â”œâ”€â”€ ðŸ“ server/                 # Server implementation tests
â”‚   â”œâ”€â”€ ðŸ“ tools/                  # Tool implementation tests
â”‚   â”œâ”€â”€ ðŸ“ resources/              # Resource tests
â”‚   â”œâ”€â”€ ðŸ“ prompts/                # Prompt tests
â”‚   â”œâ”€â”€ ðŸ“ utilities/              # Utility tests
â”‚   â”œâ”€â”€ ðŸ“ contrib/                # Contribution tests
â”‚   â”œâ”€â”€ ðŸ“ task_management/        # Task management integration tests
â”‚   â””â”€â”€ ðŸ“ deprecated/             # Legacy test preservation
â”œâ”€â”€ ðŸ“ docs/                       # Project documentation
â”œâ”€â”€ ðŸ“ examples/                   # Minimal runnable demos
â”œâ”€â”€ ðŸ“ .venv/                      # Python virtual environment
â”œâ”€â”€ ðŸ“ .github/                    # GitHub workflows and templates
â””â”€â”€ ðŸ“ htmlcov/                    # Coverage reports
```

## ðŸ§± dhafnck_mcp Core Architecture

### 1. Server Layer (`src/fastmcp/server/`)
**Purpose**: MCP server implementation, networking, and authentication

```
server/
â”œâ”€â”€ ðŸ“„ server.py                   # dhafnck_mcp main server class
â”œâ”€â”€ ðŸ“„ context.py                  # Request context management
â”œâ”€â”€ ðŸ“„ auth.py                     # Authentication and authorization
â”œâ”€â”€ ðŸ“„ networking.py               # Network protocol handling
â”œâ”€â”€ ðŸ“„ middleware.py               # Request/response middleware
â””â”€â”€ ðŸ“„ exceptions.py               # Server-specific exceptions
```

### 2. Client Layer (`src/fastmcp/client/`)
**Purpose**: High-level client SDK and helper utilities

```
client/
â”œâ”€â”€ ðŸ“„ __init__.py                 # Client exports
â”œâ”€â”€ ðŸ“„ client.py                   # Main MCP client implementation
â”œâ”€â”€ ðŸ“„ connection.py               # Connection management
â”œâ”€â”€ ðŸ“„ transport.py                # Transport layer abstractions
â””â”€â”€ ðŸ“„ helpers.py                  # Client utility functions
```

### 3. MCP Object Implementations

#### Tools (`src/fastmcp/tools/`)
**Purpose**: MCP tool definitions and implementations
- Executable functions exposed to MCP clients
- Input validation and output formatting
- Error handling and logging

#### Resources (`src/fastmcp/resources/`)  
**Purpose**: MCP resources and resource templates
- Static and dynamic resource management
- Template-based resource generation
- Resource discovery and caching

#### Prompts (`src/fastmcp/prompts/`)
**Purpose**: MCP prompt templates and management
- Reusable prompt templates
- Parameter substitution
- Prompt validation and formatting

### 4. Task Management Integration (`src/fastmcp/task_management/`)
**Purpose**: Complete task management system with DDD architecture

```
task_management/
â”œâ”€â”€ ðŸ“ domain/                     # Domain layer (business logic)
â”‚   â”œâ”€â”€ ðŸ“ entities/               # Core business entities
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ task.py             # Task entity with business rules
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ agent.py            # Agent entity  
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ project.py          # Project entity
â”‚   â”‚   â””â”€â”€ ðŸ“„ task_tree.py        # Task tree entity
â”‚   â”œâ”€â”€ ðŸ“ value_objects/          # Domain value objects
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ task_id.py          # Task identifier
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ task_status.py      # Status enumeration
â”‚   â”‚   â””â”€â”€ ðŸ“„ priority.py         # Priority value object
â”‚   â”œâ”€â”€ ðŸ“ events/                 # Domain events
â”‚   â”œâ”€â”€ ðŸ“ exceptions/             # Domain-specific exceptions
â”‚   â”œâ”€â”€ ðŸ“ repositories/           # Repository interfaces
â”‚   â””â”€â”€ ðŸ“ services/               # Domain services
â”œâ”€â”€ ðŸ“ application/                # Application layer (use cases)
â”‚   â”œâ”€â”€ ðŸ“ use_cases/              # Business use cases
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ create_task.py      # Create task use case
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ get_task.py         # Get task use case
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ update_task.py      # Update task use case
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ delete_task.py      # Delete task use case
â”‚   â”‚   â””â”€â”€ ðŸ“„ search_tasks.py     # Search tasks use case
â”‚   â”œâ”€â”€ ðŸ“ services/               # Application services
â”‚   â””â”€â”€ ðŸ“ dtos/                   # Data transfer objects
â”œâ”€â”€ ðŸ“ infrastructure/             # Infrastructure layer
â”‚   â”œâ”€â”€ ðŸ“ repositories/           # Repository implementations
â”‚   â””â”€â”€ ðŸ“ services/               # External service integrations
â””â”€â”€ ðŸ“ interface/                  # Interface layer (MCP integration)
    â””â”€â”€ ðŸ“„ mcp_tools.py            # MCP tool implementations
```

### 5. Utilities and Shared Components (`src/fastmcp/utilities/`)
**Purpose**: Shared utilities, types, and helper functions

```
utilities/
â”œâ”€â”€ ðŸ“„ types.py                    # Common type definitions
â”œâ”€â”€ ðŸ“„ validation.py               # Input validation utilities
â”œâ”€â”€ ðŸ“„ logging.py                  # Logging configuration
â”œâ”€â”€ ðŸ“„ serialization.py            # JSON/YAML serialization
â””â”€â”€ ðŸ“„ decorators.py               # Common decorators
```

### 6. Community Contributions (`src/fastmcp/contrib/`)
**Purpose**: Community-contributed extensions and plugins

## ðŸ§ª Testing Architecture (`tests/`)

### Test Organization Strategy
- **Unit Tests**: Individual component testing
- **Integration Tests**: Cross-component interaction testing  
- **End-to-End Tests**: Full workflow testing
- **Performance Tests**: Load and stress testing
- **Compatibility Tests**: Cross-platform validation

### Test Structure
```
tests/
â”œâ”€â”€ ðŸ“„ conftest.py                 # Pytest configuration and fixtures
â”œâ”€â”€ ðŸ“ auth/                       # Authentication system tests
â”œâ”€â”€ ðŸ“ cli/                        # Command-line interface tests
â”œâ”€â”€ ðŸ“ client/                     # Client SDK tests
â”œâ”€â”€ ðŸ“ server/                     # Server implementation tests
â”œâ”€â”€ ðŸ“ tools/                      # MCP tools tests
â”œâ”€â”€ ðŸ“ resources/                  # MCP resources tests
â”œâ”€â”€ ðŸ“ prompts/                    # MCP prompts tests
â”œâ”€â”€ ðŸ“ utilities/                  # Utilities tests
â”œâ”€â”€ ðŸ“ contrib/                    # Community contributions tests
â”œâ”€â”€ ðŸ“ task_management/            # Task management integration tests
â”‚   â”œâ”€â”€ ðŸ“„ test_domain_entities.py
â”‚   â”œâ”€â”€ ðŸ“„ test_use_cases.py
â”‚   â””â”€â”€ ðŸ“„ test_mcp_integration.py
â”œâ”€â”€ ðŸ“ deprecated/                 # Legacy test preservation
â””â”€â”€ ðŸ“ unit/                       # Isolated unit tests
```

## ðŸš€ Development Workflow

### Mandatory Development Process
```bash
# Environment setup
uv sync                              # Install dependencies

# Code quality checks
uv run pre-commit run --all-files    # Ruff + Prettier + Pyright

# Testing
uv run pytest                        # Run full test suite
uv run pytest tests/quick/           # Quick smoke tests
uv run pytest --cov                  # Coverage analysis
```

### Code Quality Standards
- **Language**: Python â‰¥ 3.10
- **Type Checking**: Full type annotations with Pyright
- **Code Style**: Enforced through Ruff and pre-commit hooks
- **Testing**: Comprehensive test coverage requirement
- **Documentation**: Mintlify-flavored Markdown

## ðŸ“š Documentation Architecture (`docs/`)

### Documentation Structure
```
docs/
â”œâ”€â”€ ðŸ“ getting-started/            # Quick start guides
â”œâ”€â”€ ðŸ“ python-sdk/                 # Python SDK documentation
â”œâ”€â”€ ðŸ“ servers/                    # Server implementation guides
â”œâ”€â”€ ðŸ“ clients/                    # Client usage documentation
â”œâ”€â”€ ðŸ“ integrations/               # Integration examples
â”œâ”€â”€ ðŸ“ patterns/                   # Design patterns and best practices
â”œâ”€â”€ ðŸ“ tutorials/                  # Step-by-step tutorials
â”œâ”€â”€ ðŸ“ deployment/                 # Deployment guides
â”œâ”€â”€ ðŸ“ community/                  # Community resources
â””â”€â”€ ðŸ“ assets/                     # Documentation assets
```

### Documentation Publishing
- **Platform**: GitHub Pages / Documentation site
- **Source**: Markdown files in `docs/`
- **Automation**: Automated publishing pipeline

## ðŸ”§ Configuration Management

### Project Configuration (`pyproject.toml`)
- **Build System**: Hatchling with UV dynamic versioning
- **Dependencies**: Core MCP dependencies + task management additions
- **Scripts**: CLI entry points via `dhafnck_mcp` command
- **Development Dependencies**: Comprehensive dev toolchain

### Settings Management (`src/fastmcp/settings.py`)
- **Environment Variables**: Centralized configuration
- **Runtime Settings**: Dynamic configuration management
- **Validation**: Configuration validation and defaults

## ðŸŽ¯ Key Integration Points

### MCP Protocol Compliance
- **Standard Compliance**: Full MCP specification implementation
- **Extension Points**: Custom tool/resource/prompt registration
- **Transport Layers**: WebSocket, HTTP, and custom transports

### Task Management Integration
- **MCP Tools**: Task management exposed as MCP tools
- **Domain-Driven Design**: Clean architecture separation
- **Event-Driven**: Domain events for workflow automation

### Development Experience
- **Type Safety**: Full type checking with Pyright
- **Hot Reloading**: Development server with auto-reload
- **Rich Debugging**: Enhanced error reporting and tracing

## ðŸ“ˆ Performance and Scalability

### Architecture Decisions
- **Async/Await**: Full asynchronous implementation
- **Connection Pooling**: Efficient resource management  
- **Caching**: Multi-level caching strategies
- **Load Balancing**: Horizontal scaling support

### Monitoring and Observability
- **Metrics**: Performance metrics collection
- **Logging**: Structured logging with correlation IDs
- **Health Checks**: Comprehensive health monitoring
- **Tracing**: Distributed tracing support

## ðŸ”’ Security Architecture

### Authentication and Authorization
- **OAuth2**: Standard OAuth2 implementation
- **API Keys**: API key-based authentication
- **Role-Based Access**: Granular permission system
- **Rate Limiting**: Request rate limiting and throttling

### Data Protection
- **Input Validation**: Comprehensive input sanitization
- **Output Encoding**: Safe output encoding
- **Audit Logging**: Security event logging
- **Encryption**: Data encryption at rest and in transit

---

## ðŸŽª Usage Examples

### Basic MCP Server
```python
from fastmcp import FastMCP

app = FastMCP("my-server")

@app.tool()
def hello(name: str) -> str:
    return f"Hello, {name}!"

if __name__ == "__main__":
    app.run()
```

### Task Management Integration
```python
from fastmcp.task_management import TaskManager

# Task management automatically exposed as MCP tools
task_manager = TaskManager()
app.integrate(task_manager)
```

This architecture ensures **dhafnck_mcp** provides a robust, scalable, and maintainable foundation for building MCP servers while integrating advanced task management capabilities through clean domain-driven design principles.
