---
description: 
globs: 
alwaysApply: false
---
# Project Organization Guide

**Project**: Agentic Coding Framework - Cursor Agent
**Version**: 2.0.0
**Last Updated**: 2025-01-16

## Overview


This document provides a comprehensive guide to the organization and structure of the Cursor Agent project, which is part of the larger Agentic Coding Framework. The project implements a Domain-Driven Design (DDD) architecture with MCP (Model Context Protocol) server capabilities for task management and intelligent code assistance.

## ğŸ—ï¸ Project Architecture

### Core Architecture Pattern
- **Domain-Driven Design (DDD)**: Clean separation of concerns across layers [ddd-structure.mdc](mdc:cursor_agent/.cursor/rules/ddd-structure.mdc)
- **MCP Server**: Model Context Protocol implementation for Cursor IDE integration [configuration.mdc](mdc:cursor_agent/.cursor/rules/configuration.mdc)
- **Consolidated Tools**: 8 MCP tools organized in logical categories
- **YAML-Based Configuration**: Role definitions and workflow configurations
- **Test-Driven Development**: Comprehensive testing across all layers

## ğŸ“ Directory Structure

```
cursor_agent/
â”œâ”€â”€ ğŸ“„ pyproject.toml              # Python project configuration
â”œâ”€â”€ ğŸ“„ pytest.ini                  # Testing configuration
â”œâ”€â”€ ğŸ“„ uv.lock                     # UV dependency lock file
â”œâ”€â”€ ğŸ“„ mcp_config_example.json     # MCP configuration example
â”œâ”€â”€ ğŸ“„ tsconfig.json               # TypeScript configuration
â”œâ”€â”€ ğŸ“ src/                        # Source code (DDD architecture)
â”‚   â”œâ”€â”€ ğŸ“„ __init__.py
â”‚   â”œâ”€â”€ ğŸ“„ mcp_server.py           # Main MCP server entry point
â”‚   â”œâ”€â”€ ğŸ“„ index.ts                # TypeScript configuration
â”‚   â””â”€â”€ ğŸ“ task_mcp/               # Task management MCP module
â”‚       â”œâ”€â”€ ğŸ“„ __init__.py
â”‚       â”œâ”€â”€ ğŸ“ domain/             # Domain layer (business logic)
â”‚       â”œâ”€â”€ ğŸ“ application/        # Application layer (use cases)
â”‚       â”œâ”€â”€ ğŸ“ infrastructure/     # Infrastructure layer (external concerns)
â”‚       â””â”€â”€ ğŸ“ interface/          # Interface layer (MCP tools)
â”œâ”€â”€ ğŸ“ tests/                      # Test files
â”‚   â”œâ”€â”€ ğŸ“ dev/                    # Development tests
â”‚   â”‚   â”œâ”€â”€ ğŸ“ unit/               # Unit tests
â”‚   â”‚   â””â”€â”€ ğŸ“ integration/        # Integration tests
â”‚   â”œâ”€â”€ ğŸ“ quick/                  # Quick smoke tests
â”‚   â””â”€â”€ ğŸ“ fixtures/               # Test fixtures
â”œâ”€â”€ ğŸ“ .venv/                      # Python virtual environment
â”œâ”€â”€ ğŸ“ yaml-lib/                   # YAML role definitions and configurations
â”œâ”€â”€ ğŸ“ examples/                   # Usage examples
â”œâ”€â”€ ğŸ“ logs/                       # Log files
â”œâ”€â”€ ğŸ“ htmlcov/                    # Coverage reports
â””â”€â”€ ğŸ“ .cursor/                    # Cursor IDE configuration
    â””â”€â”€ ğŸ“ rules/                  # Project documentation
```

## ğŸ§± DDD Architecture Layers

### 1. Domain Layer (`src/task_mcp/domain/`)
**Purpose**: Core business logic and domain concepts

```
domain/
â”œâ”€â”€ ğŸ“ entities/
â”‚   â”œâ”€â”€ ğŸ“„ __init__.py
â”‚   â”œâ”€â”€ ğŸ“„ task.py                 # Task entity with business rules
â”‚   â”œâ”€â”€ ğŸ“„ agent.py                # Agent entity
â”‚   â”œâ”€â”€ ğŸ“„ project.py              # Project entity
â”‚   â”œâ”€â”€ ğŸ“„ task_tree.py            # Task tree entity
â”‚   â””â”€â”€ ğŸ“„ work_session.py         # Work session entity
â”œâ”€â”€ ğŸ“ value_objects/
â”‚   â”œâ”€â”€ ğŸ“„ __init__.py
â”‚   â”œâ”€â”€ ğŸ“„ task_id.py              # Task identifier value object
â”‚   â”œâ”€â”€ ğŸ“„ task_status.py          # Task status enumeration
â”‚   â””â”€â”€ ğŸ“„ priority.py             # Priority value object
â”œâ”€â”€ ğŸ“ events/
â”‚   â”œâ”€â”€ ğŸ“„ __init__.py
â”‚   â””â”€â”€ ğŸ“„ task_events.py          # Domain events
â”œâ”€â”€ ğŸ“ exceptions/
â”‚   â”œâ”€â”€ ğŸ“„ __init__.py
â”‚   â””â”€â”€ ğŸ“„ task_exceptions.py      # Domain-specific exceptions
â”œâ”€â”€ ğŸ“ repositories/
â”‚   â”œâ”€â”€ ğŸ“„ __init__.py
â”‚   â””â”€â”€ ğŸ“„ task_repository.py      # Repository interface
â””â”€â”€ ğŸ“ services/
    â”œâ”€â”€ ğŸ“„ __init__.py
    â”œâ”€â”€ ğŸ“„ auto_rule_generator.py  # Domain service for rule generation
    â””â”€â”€ ğŸ“„ orchestrator.py         # Multi-agent orchestration service
```

### 2. Application Layer (`src/task_mcp/application/`)
**Purpose**: Use cases and application services

```
application/
â”œâ”€â”€ ğŸ“ use_cases/
â”‚   â”œâ”€â”€ ğŸ“„ __init__.py
â”‚   â”œâ”€â”€ ğŸ“„ create_task.py          # Create task use case
â”‚   â”œâ”€â”€ ğŸ“„ get_task.py             # Get task use case
â”‚   â”œâ”€â”€ ğŸ“„ list_tasks.py           # List tasks use case
â”‚   â”œâ”€â”€ ğŸ“„ update_task.py          # Update task use case
â”‚   â”œâ”€â”€ ğŸ“„ delete_task.py          # Delete task use case
â”‚   â”œâ”€â”€ ğŸ“„ complete_task.py        # Complete task use case
â”‚   â”œâ”€â”€ ğŸ“„ search_tasks.py         # Search tasks use case
â”‚   â”œâ”€â”€ ğŸ“„ do_next.py              # Do next task use case
â”‚   â”œâ”€â”€ ğŸ“„ manage_subtasks.py      # Subtask management
â”‚   â””â”€â”€ ğŸ“„ manage_dependencies.py  # Dependency management
â”œâ”€â”€ ğŸ“ services/
â”‚   â”œâ”€â”€ ğŸ“„ __init__.py
â”‚   â””â”€â”€ ğŸ“„ task_application_service.py  # Application service coordinator
â””â”€â”€ ğŸ“ dtos/
    â”œâ”€â”€ ğŸ“„ __init__.py
    â””â”€â”€ ğŸ“„ task_dto.py             # Data transfer objects
```

### 3. Infrastructure Layer (`src/task_mcp/infrastructure/`)
**Purpose**: External concerns and implementations

```
infrastructure/
â”œâ”€â”€ ğŸ“ repositories/
â”‚   â”œâ”€â”€ ğŸ“„ __init__.py
â”‚   â””â”€â”€ ğŸ“„ json_task_repository.py # JSON file repository implementation
â”œâ”€â”€ ğŸ“ services/
â”‚   â”œâ”€â”€ ğŸ“„ __init__.py
â”‚   â”œâ”€â”€ ğŸ“„ file_auto_rule_generator.py  # File-based rule generator
â”‚   â””â”€â”€ ğŸ“ legacy/                 # Legacy components (preserved for compatibility)
â”‚       â”œâ”€â”€ ğŸ“„ __init__.py
â”‚       â”œâ”€â”€ ğŸ“„ models.py
â”‚       â”œâ”€â”€ ğŸ“„ project_analyzer.py
â”‚       â”œâ”€â”€ ğŸ“„ role_manager.py
â”‚       â”œâ”€â”€ ğŸ“„ rules_generator.py
â”‚       â””â”€â”€ ğŸ“ project_analyzer/   # Project analysis modules
```

### 4. Interface Layer (`src/task_mcp/interface/`)
**Purpose**: MCP protocol implementation and external interfaces

```
interface/
â”œâ”€â”€ ğŸ“„ __init__.py
â”œâ”€â”€ ğŸ“„ ddd_mcp_server.py              # DDD-based MCP server implementation
â”œâ”€â”€ ğŸ“„ consolidated_mcp_server.py     # Consolidated server
â”œâ”€â”€ ğŸ“„ consolidated_mcp_tools_v2.py   # Main MCP tools (3 tools)
â””â”€â”€ ğŸ“„ cursor_rules_tools.py          # Cursor rules tools (5 tools)
```

## ğŸ“š YAML Library (`yaml-lib/`)

### Purpose
Role-based configuration system for intelligent code assistance and workflow management.

### Structure
```
yaml-lib/
â”œâ”€â”€ ğŸ“ cache_engineer/            # Cache engineering role
â”œâ”€â”€ ğŸ“ cli_engineer/              # CLI engineering role
â”œâ”€â”€ ğŸ“ code_reviewer/             # Code review role
â”œâ”€â”€ ğŸ“ context_engineer/          # Context analysis role
â”œâ”€â”€ ğŸ“ devops_engineer/           # DevOps engineering role
â”œâ”€â”€ ğŸ“ metrics_engineer/          # Metrics and monitoring role
â”œâ”€â”€ ğŸ“ platform_engineer/         # Platform engineering role
â”œâ”€â”€ ğŸ“ qa_engineer/               # Quality assurance role
â”œâ”€â”€ ğŸ“ security_engineer/         # Security engineering role
â”œâ”€â”€ ğŸ“ senior_developer/          # Senior development role
â”œâ”€â”€ ğŸ“ task_planner/              # Task planning role
â””â”€â”€ ğŸ“ technical_writer/          # Technical writing role
```

### Role Structure Template
Each role directory follows this structure:
```
role_name/
â”œâ”€â”€ ğŸ“„ job_desc.yaml              # Role description and persona
â”œâ”€â”€ ğŸ“ contexts/                  # Context-specific configurations
â”œâ”€â”€ ğŸ“ rules/                     # Role-specific rules and practices
â”œâ”€â”€ ğŸ“ tools/                     # Role-specific tools and utilities
â””â”€â”€ ğŸ“ output_format/             # Expected output formats
```

## ğŸ§ª Testing Structure (`tests/`)

### Test Organization
```
tests/
â”œâ”€â”€ ğŸ“„ conftest.py                # Test configuration
â”œâ”€â”€ ğŸ“ dev/                       # Development tests
â”‚   â”œâ”€â”€ ğŸ“ unit/                  # Unit tests for all layers
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ test_domain_entities.py
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ test_value_objects.py
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ test_mcp_tools.py
â”‚   â”‚   â””â”€â”€ ... (20+ test files)
â”‚   â””â”€â”€ ğŸ“ integration/           # Integration tests
â”‚       â”œâ”€â”€ ğŸ“„ test_mcp_integration.py
â”‚       â”œâ”€â”€ ğŸ“„ test_auto_rule_integration.py
â”‚       â””â”€â”€ ... (integration test files)
â”œâ”€â”€ ğŸ“ quick/                     # Quick smoke tests
â”‚   â”œâ”€â”€ ğŸ“„ test_basic_api.py
â”‚   â”œâ”€â”€ ğŸ“„ test_imports.py
â”‚   â””â”€â”€ ğŸ“„ test_server_start.py
â””â”€â”€ ğŸ“ fixtures/                  # Test data
    â””â”€â”€ ğŸ“„ test_tasks.json
```

### Test Categories
- **Unit Tests**: Domain logic and business rules
- **Integration Tests**: Layer interactions and data flow
- **MCP Tests**: Protocol implementation and tool functionality
- **YAML Tests**: Configuration loading and validation

## ğŸ”§ Configuration Files

### Project Configuration
- **`pyproject.toml`**: Python project metadata, dependencies, and build configuration
- **`pytest.ini`**: Test runner configuration
- **`uv.lock`**: UV dependency version lock file
- **`mcp_config_example.json`**: MCP server configuration example
- **`tsconfig.json`**: TypeScript configuration

### MCP Server Configuration
- **Location**: `~/.cursor/mcp.json` (system-wide)
- **Purpose**: Cursor IDE integration configuration
- **Server Entry**: `cursor_agent/src/mcp_server.py`

## ğŸ› ï¸ MCP Tools (8 Total)

### Project Management Category (3 tools)
1. **`manage_project`** - Complete multi-agent project lifecycle management
   - Actions: create, get, list, create_tree, get_tree_status, orchestrate, dashboard
2. **`manage_task`** - Comprehensive task lifecycle management
   - Actions: create, get, update, delete, complete, list, search, next, add_subtask, complete_subtask, list_subtasks, add_dependency, list_dependencies
3. **`manage_agent`** - Multi-agent team management and intelligent assignment
   - Actions: register, get, list, update, unregister, assign, unassign, get_assignments, get_workload, rebalance, add_capability, remove_capability

### Cursor Rules Management Category (5 tools)
4. **`update_auto_rule`** - Direct update of AI assistant context rules
5. **`validate_rules`** - Comprehensive rule file quality and structure analysis
6. **`manage_cursor_rules`** - Complete rule file system management
   - Actions: list, backup, restore, clean, info
7. **`regenerate_auto_rule`** - Smart context generation for AI assistant
8. **`validate_tasks_json`** - Tasks.json integrity validator

## ğŸ“‹ Data Storage

### Task Storage
- **Format**: JSON with atomic operations
- **Location**: `.cursor/rules/tasks/tasks.json`
- **Features**: Validation, concurrent access handling, backup support

### Context Files
- **Location**: `.cursor/rules/contexts/context_[task_id].txt`
- **Purpose**: Task-specific context and progress tracking
- **Auto-Generation**: Created/updated by `get_task` MCP tool

## ğŸ”„ Workflow Integration

### Auto Rule Generation
- **Trigger**: `manage_task` with action="get"
- **Output**: `.cursor/rules/auto_rule.mdc`
- **Source**: YAML role definitions + project analysis
- **Purpose**: Provide task-specific AI assistant context

### Task Planning Workflow
- **Configuration**: `yaml-lib/task_planner/tools/003_lite_workflow_config.yaml`
- **Tools**: `workflow_tools.py`, `workflow_cli.py`, `workflow_examples.py`
- **Features**: 4 feature types, 12 phases, 10 roles

## ğŸ” Security and Data Safety

### Data Protection
- **Atomic File Operations**: Prevent data corruption
- **Input Validation**: All MCP tool parameters validated
- **Error Handling**: Comprehensive error recovery mechanisms
- **Access Control**: Proper file permissions and sanitization

## ğŸ“– Documentation

### Project Documentation
- **Location**: `cursor_agent/.cursor/rules/`
- **Files**: 
  - `project_organization.mdc` (this file)
  - `configuration.mdc` - MCP server configuration
  - `ddd-structure.mdc` - DDD architecture details

### Main Project Documentation
- **Location**: `.cursor/rules/`
- **Key Files**:
  - `main_objectif.mdc` - Main project objectives and MCP configuration
  - `tasks/tasks.json` - Task management data
  - `auto_rule.mdc` - Auto-generated AI assistant rules

## ğŸš€ Development Workflow

### Getting Started
1. **Environment Setup**: `cursor_agent/.venv/` (Python virtual environment)
2. **Dependencies**: Managed via `pyproject.toml` and `uv.lock`
3. **MCP Server**: Start with `cursor_agent/src/mcp_server.py`
4. **Testing**: Run tests from `cursor_agent/tests/`

### Development Principles
- **DDD Architecture**: Maintain clean layer separation
- **Test-Driven Development**: Comprehensive test coverage
- **YAML Configuration**: Use YAML for role and workflow definitions
- **MCP Integration**: All functionality exposed via MCP tools
- **Documentation**: Keep documentation up-to-date with code changes

## ğŸ“‹ File Creation Rules

### âš ï¸ CRITICAL: File Location Rules
**AI assistants and developers MUST follow these strict file location rules:**

#### **1. Source Code Files**
```
âœ… CORRECT LOCATIONS:
- Domain entities: cursor_agent/src/task_mcp/domain/entities/
- Value objects: cursor_agent/src/task_mcp/domain/value_objects/
- Use cases: cursor_agent/src/task_mcp/application/use_cases/
- Repositories: cursor_agent/src/task_mcp/infrastructure/repositories/
- MCP tools: cursor_agent/src/task_mcp/interface/
- Main server: cursor_agent/src/mcp_server.py

âŒ NEVER CREATE IN:
- Root directory (/)
- .cursor/rules/ (reserved for documentation)
- cursor_agent/ root (only for config files)
```

#### **2. Test Files**
```
âœ… CORRECT LOCATION:
- ALL test files: cursor_agent/tests/

âŒ NEVER CREATE IN:
- Root directory
- src/ directories
- Any other location
```

#### **3. YAML Configuration Files**
```
âœ… CORRECT LOCATIONS:
- Role definitions: cursor_agent/yaml-lib/[role_name]/
- Job descriptions: cursor_agent/yaml-lib/[role_name]/job_desc.yaml
- Tools: cursor_agent/yaml-lib/[role_name]/tools/
- Contexts: cursor_agent/yaml-lib/[role_name]/contexts/
- Rules: cursor_agent/yaml-lib/[role_name]/rules/

âŒ NEVER CREATE IN:
- Root directory
- src/ directories
- .cursor/rules/
```

#### **4. Documentation Files**
```
âœ… CORRECT LOCATIONS:
- Project docs: cursor_agent/.cursor/rules/
- Main project docs: .cursor/rules/
- Context files: .cursor/rules/contexts/
- Task data: .cursor/rules/tasks/

âŒ NEVER CREATE IN:
- Root directory (unless explicitly requested)
- src/ directories
- yaml-lib/ directories
```

#### **5. Configuration Files**
```
âœ… CORRECT LOCATIONS:
- Python config: cursor_agent/pyproject.toml
- Test config: cursor_agent/pytest.ini
- Dependencies: cursor_agent/uv.lock
- MCP config: cursor_agent/mcp_config_example.json

âŒ NEVER CREATE IN:
- Root directory (unless explicitly requested)
- Nested subdirectories
```

### ğŸš« File Creation Restrictions

#### **Root Directory Protection**
```
âš ï¸ NEVER create files in root directory (/) unless:
1. User explicitly requests it
2. It's a standard project file (README.md, .gitignore, etc.)
3. User gives specific permission

âœ… Always ask user before creating root files
âŒ Never assume root directory creation is okay
```

#### **Directory Structure Preservation**
```
ğŸ”’ PROTECTED DIRECTORIES:
- .cursor/rules/ (AI documentation only)
- cursor_agent/src/ (source code only)
- cursor_agent/yaml-lib/ (YAML configs only)
- cursor_agent/tests/ (test files only)

âš ï¸ Each directory has a specific purpose - respect it!
```

#### **File Type Rules**
```
ğŸ“ cursor_agent/src/ â†’ ONLY Python source code
ğŸ“ cursor_agent/tests/ â†’ ONLY test files (test_*.py)
ğŸ“ cursor_agent/yaml-lib/ â†’ ONLY YAML configurations
ğŸ“ cursor_agent/.cursor/rules/ â†’ ONLY project documentation
ğŸ“ .cursor/rules/ â†’ ONLY main project documentation
```

### ğŸ¯ Before Creating Any File

#### **Mandatory Checklist**
1. **â“ Ask yourself**: "Where should this file go according to its purpose?"
2. **ğŸ“‹ Check the rules**: Does this location match the file creation rules?
3. **ğŸ” Verify path**: Is this the correct directory for this file type?
4. **âš ï¸ Root check**: Am I about to create a file in the root directory?
5. **ğŸ‘¤ User permission**: Did the user explicitly request this location?

#### **Decision Tree**
```
Is it a Python source file?
â”œâ”€ YES â†’ cursor_agent/src/task_mcp/[appropriate_layer]/
â””â”€ NO â†’ Is it a test file?
    â”œâ”€ YES â†’ cursor_agent/tests/
    â””â”€ NO â†’ Is it YAML config?
        â”œâ”€ YES â†’ cursor_agent/yaml-lib/[role]/
        â””â”€ NO â†’ Is it documentation?
            â”œâ”€ YES â†’ cursor_agent/.cursor/rules/ OR .cursor/rules/
            â””â”€ NO â†’ ASK USER FOR PERMISSION
```

### ğŸš¨ Common Mistakes to Avoid

#### **âŒ Wrong Locations**
```
WRONG: Creating test files in root directory
RIGHT: cursor_agent/tests/test_*.py

WRONG: Creating source files in cursor_agent/
RIGHT: cursor_agent/src/task_mcp/[layer]/

WRONG: Creating YAML files in .cursor/rules/
RIGHT: cursor_agent/yaml-lib/[role]/

WRONG: Creating docs in root directory
RIGHT: cursor_agent/.cursor/rules/ or .cursor/rules/
```

#### **âŒ Permission Assumptions**
```
WRONG: "I'll create this utility in root directory"
RIGHT: "Where should I create this file? Let me check the rules."

WRONG: Creating files without considering project structure
RIGHT: Following the established directory hierarchy
```

### ğŸ”§ File Creation Process

#### **Step-by-Step Process**
1. **Identify file type** (source, test, config, docs)
2. **Check location rules** (refer to this document)
3. **Verify directory exists** (create if needed following structure)
4. **Create file in correct location**
5. **Update relevant documentation** (if needed)

#### **Location Verification Commands**
```bash
# Check if you're in the right directory
pwd

# Verify target directory exists
ls -la cursor_agent/src/task_mcp/domain/entities/

# Create directory if needed (following structure)
mkdir -p cursor_agent/tests/
```

## ğŸ” Key Integration Points

### Cursor IDE Integration
- **MCP Server**: Provides 8 tools for task management
- **Auto Rules**: Dynamic rule generation based on task context
- **Context Tracking**: Automatic context file management

### YAML-Based Intelligence
- **Role Definitions**: 12 specialized roles with specific capabilities
- **Workflow Configuration**: Structured development workflows
- **Context Generation**: Intelligent rule generation based on project analysis

## ğŸ“Š Project Metrics

### Code Organization
- **Total Roles**: 12 specialized roles
- **MCP Tools**: 8 functional tools (3 project management + 5 cursor rules)
- **Test Coverage**: Comprehensive across all layers
- **Documentation**: Complete project documentation

### Technology Stack
- **Language**: Python 3.8+
- **Protocol**: MCP (Model Context Protocol)
- **Architecture**: Domain-Driven Design (DDD)
- **Storage**: JSON with atomic operations
- **Configuration**: YAML-based role system
- **Testing**: pytest with comprehensive coverage
- **Package Management**: UV (modern Python package manager)

---

*This document provides a complete overview of the Cursor Agent project organization. For specific implementation details, refer to the source code and individual component documentation.*
