---
description:
globs:
alwaysApply: false
---
# TASK CONTEXT: Phase 5 - Migrate and Integrate Interface Layer

**Task ID**: `20250621006`
**Assignee**: `@coding_agent`
**Status**: `todo`
**Priority**: `high`

## 1. Objective

Migrate and integrate the Interface Layer from `cursor_agent/src/task_mcp/interface/` to `dhafnck_mcp_main/src/fastmcp/dhafnck_mcp/interface/`. This involves copying interface files and integrating the FastAPI routers into the main application server in `dhafnck_mcp_main/src/fastmcp/server/`.

## 2. Technical Requirements

### Source Files to Migrate:
```
cursor_agent/src/task_mcp/interface/
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ routers/
â”‚   â”œâ”€â”€ schemas/
â”‚   â””â”€â”€ middleware/
â”œâ”€â”€ mcp_handlers/
â”œâ”€â”€ serializers/
â””â”€â”€ validators/
```

### Target Location:
```
dhafnck_mcp_main/src/fastmcp/dhafnck_mcp/interface/
```

### Integration Points:
```
dhafnck_mcp_main/src/fastmcp/server/
â”œâ”€â”€ main.py (FastAPI app integration)
â”œâ”€â”€ routers/ (router registration)
â””â”€â”€ middleware/ (middleware integration)
```

### Key Implementation Steps:
1. **Copy Interface Files**: Transfer all interface layer files
2. **Update Import References**: Fix imports to use migrated layers
3. **Integrate FastAPI Routers**: Register routers in main FastAPI application
4. **Adapt MCP Handlers**: Ensure MCP tool handlers work with new structure
5. **Update API Schemas**: Validate Pydantic models and serializers
6. **Test API Endpoints**: Verify all endpoints function correctly

## 3. Migration Specifics

### Import Path Changes:
- **Application Layer References**: 
  - **From**: `from task_mcp.application.services import TaskService`
  - **To**: `from fastmcp.task_management.application.services import TaskService`
- **Interface References**:
  - **From**: `from task_mcp.interface.api.schemas import TaskSchema`
  - **To**: `from fastmcp.task_management.interface.api.schemas import TaskSchema`

### FastAPI Integration:
```python
# In dhafnck_mcp_main/src/fastmcp/server/main.py
from fastmcp.task_management.interface.api.routers import task_router

app.include_router(task_router, prefix="/api/v1/tasks", tags=["tasks"])
```

### Interface Components to Migrate:
- **API Routers**: FastAPI route handlers
- **Schemas**: Pydantic models for request/response validation
- **MCP Handlers**: MCP protocol tool implementations
- **Serializers**: Data transformation utilities
- **Validators**: Input validation logic
- **Middleware**: Request/response processing middleware

## 4. Success Criteria

- [ ] All interface files copied to new location
- [ ] Import paths updated correctly
- [ ] FastAPI routers integrated into main application
- [ ] MCP handlers functional with new structure
- [ ] API endpoints accessible and working
- [ ] Request/response schemas validated
- [ ] Authentication and authorization maintained
- [ ] API documentation generated correctly

## 5. Dependencies

**Requires**: 
- Task 20250621003 (Domain Layer Migration) - ðŸ”„ In Progress
- Task 20250621004 (Application Layer Migration) - ðŸ”„ In Progress  
- Task 20250621005 (Infrastructure Layer Migration) - ðŸ”„ In Progress
**Blocks**: Task 20250621007 (Integration Tests)
**References**: [`migration_plan.md`](mdc:../../migration_plan.md)
**Part of**: EPIC 20250621001 - Complete task_mcp module migration

## 6. Testing Strategy

### Interface Tests to Validate:
- API endpoint functionality
- Request/response validation
- MCP tool handler operations
- Authentication flows
- Error handling and status codes
- API documentation accuracy

### Integration Validation:
- [ ] End-to-end API workflows
- [ ] MCP protocol compatibility
- [ ] Application service integration
- [ ] Database persistence through API
- [ ] External service API calls

## 7. Critical Integration Points

### FastAPI Application Integration:
- Router registration in main application
- Middleware stack integration
- Dependency injection setup
- Exception handler configuration
- CORS and security settings

### MCP Protocol Integration:
- Tool handler registration
- Protocol message handling
- Client/server communication
- Error response formatting

### API Design Consistency:
- Follow `fastmcp` API conventions
- Maintain consistent response formats
- Implement proper HTTP status codes
- Ensure OpenAPI specification accuracy

## 8. FastMCP Framework Alignment

### API Standards:
- Use `fastmcp` response models
- Follow `fastmcp` error handling patterns
- Implement `fastmcp` authentication mechanisms
- Align with `fastmcp` logging and monitoring

### Router Organization:
- Group related endpoints logically
- Use appropriate HTTP methods
- Implement proper parameter validation
- Maintain consistent URL patterns

## 9. Security Considerations

### Authentication & Authorization:
- Integrate with `fastmcp` auth system
- Validate API key requirements
- Implement role-based access control
- Secure sensitive endpoints

### Input Validation:
- Sanitize all user inputs
- Validate request schemas
- Implement rate limiting
- Protect against injection attacks

## 10. Notes

The interface layer serves as the entry point for external interactions with the task management system. Proper integration with the `fastmcp` server framework is crucial for maintaining API consistency and ensuring seamless operation within the larger application ecosystem.
