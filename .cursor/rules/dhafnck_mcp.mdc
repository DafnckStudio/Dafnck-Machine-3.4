---
description: 
globs: 
alwaysApply: true
---
Parfait, voici une version consolidÃ©e, logique et lisible de toutes les rÃ¨gles que vous avez dÃ©finies, formatÃ©e pour une lecture optimale par lâ€™IA (et agents MCP). Elle respecte vos structures, automatismes, et contraintes de projet multi-agent.

---

## ğŸ§  **AI Assistant Runti VARIABLES & FLAGS

* `tools_count = 0` â†’ **Init at start**, **increment with each tool usage**
* `task_tree_id = <current_git_branch>` â†’ **Update if project branch changes**
* `CONTINUE_AUTOMATIC = ON`
  â†’ If `OFF` and task is completed â†’ **terminate chat**
  â†’ If `ON` â†’ **continue same task automatically**
* `USE_ABSOLUTE_PATH_FROM_ROOT_PROJECT = ON`
  â†’ Use **absolute path** from `<projet_path_root>`
  â†’ Refer to: `@need-update-this-file-if-change-pro


At each new session:

1. **Set `tools_count = 0`**
2. Load MCP context using `MCP tools`
3. Read core rule file:
   [MCP Task Management: Best Practices Guide.mdc](mdc:.cursor/rules/MCP Task Management: Best Practices Guide.mdc)
4. Read project structure & context:
   [need-update-this-file-if-change-project-tree.mdc](mdc:.cursor/rules/need-update-this-file-if-change-project-tree.mdc)

---

### ğŸ” **DURING CHAT SESSION**

#### ğŸ“Œ TOOL USAGE

* Every **tool use**: `tools_count += 1`
* If `tools_count == 20`:
  â†’ `tools_count = 0`
  â†’ Call: `manage_context()` to sync current session

---

#### ğŸ’» TERMINAL COMMANDS

* Run with timeout protection
  â†’ **If no result > 20s** â†’ Force quit
  â†’ Always show result if any

---

#### ğŸ‘¤ MCP AGENT TOOL CALL

**Use this sequence for each agent interaction:**

```text
"Call Agent..."         â†’ call_agent()
"Retrieve Knowledge..." â†’ (gather all relevant info)
"Switch Agent Capacity..." â†’ (end call)
"Using dhafnck Tool..." â†’ (for call tools is not call_agent())
```

---

### ğŸ”„ **MCP ORCHESTRATIONs must follow: `@task_management_workflow.mdc`
* When `get_

  * Always check/update context from: `.cursor/rules/auto_rule.mdc`
  * Sync `context_*.md` to ensure valid state
  * Align role and context automatically with task/subtask

#### ğŸ“ FILE ACCESS RULE

* **NEVER** access `.cursor/rules/tasks/**/*` directly
  â†’ Use **`dhafnck_mcp` MCP server** to manage all tasks
  â†’ Only access manually if user explicitly requests it

---

### ğŸ” **AGENT AUTO-SWITCH SYSTEM**

Triggered on: `get_task` or `do_next` call

| Element       | Behavior                                                               |
| ------------- | ---------------------------------------------------------------------- |
| Assignee      | First `@assignee` triggers auto switch to corresponding role           |
| Agent Call    | `call_agent(name_agent="agent_name")` (strips "@")                     |
| Config Load   | Loads config from: `cursor_agent/yaml-lib/[agent_name]/`               |
| Behavior Swap | AI adapts role/knowledge automatically                                 |
| Documentation | `@Agent_Auto_Switch_Workflow.mdc` for full agent orchestration process |

---

### ğŸ“Œ FILE PATH RULE

* **If** `USE_ABSOLUTE_PATH_FROM_ROOT_PROJECT = ON`
  â†’ Use path relative to `<projet_path_root>`
  â†’ Never use relative paths from current file/folder
  â†’ Reference: `@need-update-this-file-if-change-project-tree.mdc`

---

### âœ… RULE FILE BEHAVIOR

* `.cursor/rules/auto_rule.mdc`
  â†’ AI CAN READ âœ…
  â†’ AI CANNOT EDIT âŒ

---

Souhaitez-vous que je transforme ce bloc en `.mdc` ou `